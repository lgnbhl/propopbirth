---
title: "TFR and MAB forecast"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{TFR and MAB forecast}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Overview

First, TFR (total fertility rate) and MAB (mean age of the mother at birth) forecasts are calculated. In general, the FSO uses the **same model structure** for both forecasts. However, different model types and parameters can be used for the TFR and MAB forecast.

The FSO model for TFR and MAB consists of three time periods

-   **trend** period: in the FSO model usually a few years (one to five years)
-   **temporal** period: the majority of forecast period (FSO: approximately until 2055)
-   **constant** period: end of the for forecast (FSO: until 2075)

```{r fig-time-periods, echo=FALSE, out.width='70%', fig.cap="time periods"}

knitr::include_graphics("figures/time_periods.png")

```

## Trend period

In the original FSO model, for the trend model an **ARIMA model** is used for the trend period. Depending on the structure of the past TFR and MAB data, the ARIMA forecast is not always stable. Therefore, in `{propopbirth}` a **linear model** can be used as an alternative to the ARIMA model.

+------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| module     | description                                                                              | values required                                                                                                                                                             |
+============+==========================================================================================+=============================================================================================================================================================================+
| ARIMA      | ARIMA model. The auto.arima function is used: auto.arima(x, d = 2, max.p = 3, max.q = 3) | -   `topic`: "TFR" or "MAB"                                                                                                                                                 |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `input_dataset`: input\$tfr or input\$mab                                                                                                                               |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `trend_model`: "ARIMA"                                                                                                                                                  |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `year_begin`: first year of ARIMA forecast                                                                                                                              |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `year_end`: last year of ARIMA forecast                                                                                                                                 |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `trend_prop`: proportion of the ARIMA forecast used. Number from 0 to 1 (1 = ARIMA prediction, 0 = last data value, 0.5 = mean of ARIMA prediction and last data value) |
+------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| lm         | linear model (lm function)                                                               | -   `topic`: "TFR" or "MAB"                                                                                                                                                 |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `input_dataset`: input\$tfr or input\$mab                                                                                                                               |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `trend_model`: "lm"                                                                                                                                                     |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `year_begin`: first year of linear model forecast                                                                                                                       |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `year_end`: last year of linear model forecast                                                                                                                          |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `trend_past`: how many past years are used to fit the model?                                                                                                            |
|            |                                                                                          |                                                                                                                                                                             |
|            |                                                                                          | -   `trend_prop`: proportion of the ARIMA forecast used. Number from 0 to 1 (1 = ARIMA prediction, 0 = last data value, 0.5 = mean of ARIMA prediction and last data value) |
+------------+------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

## Temporal period

In general, the FSO uses **given values** for TFR and MAB at the end of the temporal period. For the cantonal forecasts this is manageable. The FSO receives the target values from the cantons. However, this is often not possible or meaningful (e.g. forecasts for municipalities). Therefore, we provide in `{propopbirth}` an additional **data driven approach**. In this approach, the target points of the temporal period (point C in the figure below) are derived using the trend model. An additional determines, how much of the trend model is used to calculate the target point C (e.g. 0.7: 70% of the trend model is used).

```{r fig-point-C, echo=FALSE, out.width='50%', fig.cap="target point with data driven approach"}

knitr::include_graphics("figures/point_C.png")

```

For the temporal period both approaches are possible

-   **given values**: a table with target values has to be provided (for each combination of forecast; e.g. for each subregion and nationality).

-   **data driven approach**: the proportion of trend has to be selected

The FSO uses three alternatives modules for the temporal period:

+---------------+-------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------+
| module        | description                                                             | values required                                                                                                              |
+===============+=========================================================================+==============================================================================================================================+
| cubic         | interpolation from start to target point with a third-degree polynomial | -   `temporal_model`: "cubic"                                                                                                |
|               |                                                                         |                                                                                                                              |
|               |                                                                         | -   `year_begin`: first year of cubic forecast                                                                               |
|               |                                                                         |                                                                                                                              |
|               |                                                                         | -   `year_end`: last year of cubic forecast                                                                                  |
|               |                                                                         |                                                                                                                              |
|               |                                                                         | -   `trend_prop`: proportion of trend to derive the target point; has to be specified for the **data driven approach**       |
|               |                                                                         |                                                                                                                              |
|               |                                                                         | -   `temporal_end`: given target points; has to be specified if **given values** for the end of the temporal period are used |
+---------------+-------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------+
| Bézier        | interpolation from start to target point with a Bézier-curve            |                                                                                                                              |
+---------------+-------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------+
| constant      | The last value of the trend period is used for the temporal period      |                                                                                                                              |
+---------------+-------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------+

## Temporal period

```{r setup}
library(propopbirth)
```
